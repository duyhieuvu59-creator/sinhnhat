<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thiá»‡p Sinh Nháº­t 3D</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas { display: block; }

    /* NÃºt nháº¡c */
    #musicBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #ff66cc;
      color: white;
      cursor: pointer;
      z-index: 10;
    }
    #musicBtn:hover {
      background: #ff3399;
    }
  </style>
</head>
<body>
  
  <!-- NÃºt báº­t/táº¯t nháº¡c -->
  <button id="musicBtn">Báº­t nháº¡c ðŸŽµ</button>

  <!-- Nháº¡c ná»n -->
  <audio id="bgm" loop>
    <source src="music/song.mp3" type="audio/mpeg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    // ðŸ”Š Xá»­ lÃ½ nÃºt nháº¡c
    const btn = document.getElementById("musicBtn");
    const bgm = document.getElementById("bgm");
    let isPlaying = false;

    btn.addEventListener("click", () => {
      if (!isPlaying) {
        bgm.play();
        btn.textContent = "Táº¯t nháº¡c ðŸ”‡";
        isPlaying = true;
      } else {
        bgm.pause();
        btn.textContent = "Báº­t nháº¡c ðŸŽµ";
        isPlaying = false;
      }
    });

    // === Code 3D gá»‘c cá»§a báº¡n ===
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const messages = [
      "ðŸŽ‰ Grattis pÃ¥ fÃ¶delsedagen",
      "ðŸŽ‚ ChÃºc mthu sinh nháº­t vui váº» ^^",
      "ðŸ¥³ Tuá»•i má»›i tháº­t nhiá»u niá»m vui:3",
      "ðŸŒ¸ LuÃ´n háº¡nh phÃºc vÃ  thÃ nh cÃ´ng!",
      "ðŸ’ NgÃ y cÃ ng xinh Ä‘áº¹p nhÃ© ðŸ˜",
      "âœ¨ Happy Birthday! âœ¨"
    ];
    let texts = [];

    function createTextSprite(message, color="#ff66ff") {
      let canvas = document.createElement("canvas");
      canvas.width = 2048;
      canvas.height = 512;
      let ctx = canvas.getContext("2d");
      ctx.font = "Bold 120px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.shadowColor = "rgba(255,255,255,0.9)";
      ctx.shadowBlur = 25;
      ctx.lineWidth = 6;
      ctx.strokeStyle = "white";
      ctx.strokeText(message, canvas.width/2, canvas.height/2);
      ctx.fillStyle = color;
      ctx.fillText(message, canvas.width/2, canvas.height/2);

      let texture = new THREE.CanvasTexture(canvas);
      let material = new THREE.SpriteMaterial({ map: texture, transparent: true });
      let sprite = new THREE.Sprite(material);
      sprite.scale.set(canvas.width * 0.015, canvas.height * 0.015, 1);
      sprite.center.set(0.5, 0.5);
      return sprite;
    }

    messages.forEach(msg => {
      let sprite = createTextSprite(msg);
      sprite.position.set(0, (Math.random()-0.5)*8, -Math.random()*100 - 10);
      scene.add(sprite);
      texts.push(sprite);
    });

    // ðŸŽ† PhÃ¡o hoa
    let fireworks = [];
    function createFirework() {
      let geometry = new THREE.BufferGeometry();
      let particles = 150;
      let positions = new Float32Array(particles * 3);
      let velocities = [];

      for (let i = 0; i < particles; i++) {
        positions[i*3] = 0;
        positions[i*3+1] = 0;
        positions[i*3+2] = 0;

        let angle = Math.random() * Math.PI * 2;
        let speed = Math.random() * 0.2 + 0.05;
        let vz = (Math.random()-0.5) * 0.1;
        velocities.push({
          x: Math.cos(angle) * speed,
          y: Math.sin(angle) * speed,
          z: vz
        });
      }

      geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

      const colors = [0xff4444, 0xffff66, 0x66ff66, 0x66ccff, 0xff99ff, 0xff9966];
      let color = colors[Math.floor(Math.random()*colors.length)];
      let material = new THREE.PointsMaterial({ color: color, size: 0.15, transparent: true });

      let pts = new THREE.Points(geometry, material);
      pts.position.set((Math.random()-0.5)*12, (Math.random()-0.5)*7, -20);

      scene.add(pts);
      fireworks.push({obj: pts, vel: velocities, life: 80});
    }

    function updateFireworks(){
      fireworks.forEach((fw, idx)=>{
        let positions = fw.obj.geometry.attributes.position.array;
        for (let i=0; i<fw.vel.length; i++){
          positions[i*3]   += fw.vel[i].x;
          positions[i*3+1] += fw.vel[i].y;
          positions[i*3+2] += fw.vel[i].z;
        }
        fw.obj.geometry.attributes.position.needsUpdate = true;

        fw.life--;
        fw.obj.material.opacity = fw.life / 80;
        if (fw.life <= 0){
          scene.remove(fw.obj);
          fireworks.splice(idx, 1);
        }
      });
    }

    camera.position.z = 5;
    function animate(){
      requestAnimationFrame(animate);
      texts.forEach(t=>{
        t.position.z += 0.03; 
        if (t.position.z > 5) t.position.z = -100;
      });
      if (Math.random() < 0.02) createFirework();
      updateFireworks();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener("resize", ()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
